<!doctype html>
<html>
<head>
    <title>Video Editor Mode</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" type="text/css" rel="stylesheet">
    <!--
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.min.css" type="text/css" rel="stylesheet">
    -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="video.css">
</head>
<body>
    <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
        <div class="container">
            <p class="navbar-brand">Video Editor Mode</p>
        </div>
    </header>
    <div class="container">
		<ul class="nav nav-tabs" id="tabs" data-tabs="tabs">
		  <li class="active"><a href="#step1" data-toggle="tab">Step 1</a></li>
		  <li><a href="#step2" data-toggle="tab">Step 2</a></li>
		</ul>

		<div class="tab-content">
            <br/>
			<div class="tab-pane active" id="step1">
				<div class="row">
					<div class="col-xs-12 col-sm-8 col-md-6">
						<div class="videoBox">
							<div id="videoDiv"></div>
						</div>
						<div id="progress_bar"></div>
                        <br/>
                        <p><span id="videoCurrentTime">--:--</span> / <span id="videoDuration">--:--</span></p> 
                        <p>Selected: <span id="selectedId">None</span></p>
						<p><a href="javascript:void(0);" onclick="playVideo();">Play</a> | <a href="javascript:void(0);" onclick="pauseVideo();">Pause</a> | <a href="javascript:void(0);" onclick="stopVideo();">Stop</a> | <a href="javascript:void(0);" onclick="muteVideo();">Mute</a> | <a href="javascript:void(0);" onclick="unMuteVideo();">Unmute</a></p>
                        <!--div id="volumeSetting"></div-->
                        <div class="input-group">
                            <input type="text" class="form-control" id="query">
                            <span class="input-group-btn">
                                <button onclick="search()" class="btn btn-default" type="button"><span class="glyphicon glyphicon-search"></span></button>
                            </span>
                        </div>
                        <hr />
					</div>
					<div class="col-xs-12 col-sm-4 col-md-6">
						<div id="videos"></div>
					</div>
				</div> <!-- row -->
			</div> <!-- step 1-->
            <div class="tab-pane" id="step2"><!-- step 2-->
				<div class="row">
					<div class="col-xs-12 col-sm-6 col-md-6">
						<div class="videoBox"> 
							<div id="videoDiv2"></div>
						</div>
                        <div id="progress_bar_2"></div>
                        <div id="slider-range"></div>
                        <br/>
						<span id="time"></span>
						<p>(Whole video)Current Time: <span id="videoCurrentTime2">--:--</span> / <span id="videoDuration2">--:--</span></p>
						<p>(Clip)Current Time: <span id="videoCurrentTime3">--:--</span> / <span id="clipDuration">--:--</span></p>
                        <p><a href="javascript:void(0);" onclick="playFromStart2();">Play from Start</a> | <a href="javascript:void(0);" onclick="playVideo2();">Play</a> | <a href="javascript:void(0);" onclick="pauseVideo2();">Pause</a> | <a href="javascript:void(0);" onclick="stopVideo2();">Stop</a> | <a href="javascript:void(0);" onclick="muteVideo2();">Mute</a> | <a href="javascript:void(0);" onclick="unMuteVideo2();">Unmute</a> | <a href="javascript:void(0);" onclick="chopCurrentTime();">Chop</a> | <a href="learning.html" target="_blank" onclick="update();">Next</a></p>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-6">
						<div class="list">
							<ul id="chopedlist"></ul>
						</div>
					</div>
				</div><!-- row -->
			</div><!-- step 2 -->
		</div><!-- tab-content -->
    </div><!-- container -->

        
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <!--
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    -->
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <!--
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
    -->

	<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    <!--script src="video.js" type="text/javascript"></script-->
    <script>
        id = 0;
        liNo = 0;
        clipPlaying = -1;
        //isOriginal = 1;
        videoData = new Object();

        // Called automatically when JavaScript client library is loaded.
        function onClientLoad() {
            gapi.client.load('youtube', 'v3', onYouTubeApiLoad);
        }

        // Called automatically when YouTube API interface is loaded (see line 9).
        function onYouTubeApiLoad() {
            gapi.client.setApiKey('AIzaSyCR5In4DZaTP6IEZQ0r1JceuvluJRzQNLE');
        }

        function search() {
            var q = $('#query').val();
            // Use the JavaScript client library to create a search.list() API call.
            var request = gapi.client.youtube.search.list({
                part: 'snippet',
                q: q,
                type: 'video',
                maxResults: 10
            });
            
            // Send the request to the API server,
            // and invoke onSearchRepsonse() with the response.
            request.execute(onSearchResponse);
        }

        // Called automatically with the response of the YouTube API request.
        function onSearchResponse(response) {
              var str = response.result;
              var items = str.items || [];
              var html = [];
              for (var i = 0; i < 10; i++) {
                var item = items[i];
                var videoId = item.id.videoId;
                if (videoId) {
                    var img = item.snippet.thumbnails.medium.url; 
                    var name = item.snippet.title;
                    var l = '<div class="col-xs-6 col-sm-12 col-md-6"><a href=\"#\" class=\"thumbnail\" onclick=\"initVideo(\'' + videoId + '\')\"><img src=\"' + img + '\"></img><p href=\"#\">' + name + '</p></a></div>';
                    html.push(l);
                }
              }
              document.getElementById('videos').innerHTML = html.join('');
        }

        function initVideo(videoId) {

            var url = "http://gdata.youtube.com/feeds/api/videos/" + videoId + "?v=2&alt=jsonc&prettyprint=true";

            $.get(url, function(data) { 
                var duration = data["data"]["duration"];
                $("#progress_bar").slider({
                    value: 0,
                    min: 0,
                    max: duration,
                    change: function(event, ui){
                        ytplayer.seekTo(ui.value, 1);
                    }
                }); 
                        /*
                        The allowSeekAhead parameter determines whether the player will make a new request to the server if the seconds parameter specifies a time outside of the currently buffered video data.

                        We recommend that you set this parameter to false while the user drags the mouse along a video progress bar and then set it to true when the user releases the mouse. This approach lets a user scroll to different points of a video without requesting new video streams by scrolling past unbuffered points in the video. When the user releases the mouse button, the player advances to the desired point in the video and requests a new video stream if necessary.
                        */
            });
            loadVideo(videoId, 0);
        }
        function loadVideo(videoId, start) {
            if(ytplayer) {
                ytplayer.loadVideoById({
                    'videoId': videoId,
                    'startSeconds': start 
                });
                id = videoId;
            }
        }
        function loadVideo2(videoId, start, end, liNo) {
            if(ytplayer2) {
                clipPlaying = liNo;
                /*
                ytplayer2.loadVideoById({
                    'videoId': videoId,
                    'startSeconds': start
                    //'endSeconds': end
                });
                */
                ytplayer2.loadVideoById({
                    'videoId': videoId,
                    'startSeconds': start 
                });
                /*
                ytplayer2.seekTo(start, 1);
                */
                id = videoId;

                var url = "http://gdata.youtube.com/feeds/api/videos/" + videoId + "?v=2&alt=jsonc&prettyprint=true";
                var minTime;   
                var maxTime; 
                $.get(url, function(data) { 
                    var duration = data["data"]["duration"];

                    if (start <= 30) {
                        minTime = 0; 
                    }
                    else {
                        minTime = start - 30;
                    }
                    if (duration - end <= 30) {
                        maxTime = duration; 
                    }
                    else {
                        maxTime = end + 30;
                    }
                    $("#slider-range").slider({
                        range: true,
                        min: minTime,
                        max: maxTime,
                        values: [start, end],
                        step: 1,
                        slide: changeTime,
                        change: function(event, ui){
                            playSelected(videoId); 
                            changeTime(event, ui);
                            //isOriginal = 0;
                        }
                    }); 
                });
            }
        }

        function changeTime(event, ui){
                var val0 = $("#slider-range").slider("values", 0);
                var val1 = $("#slider-range").slider("values", 1);
                var l = '<a onclick=\"loadVideo2(\'' + id + '\',' + val0 + ',' + val1 + ',' + clipPlaying + ')\" href=\"#\">' + val0 + '-' + val1 + '</a>';

                $("#a" + clipPlaying).html(l);
        }

        function playSelected(id) {
              if(ytplayer2 && (clipPlaying != -1)) {
                var videoId = id;
                var start = $("#slider-range").slider("values", 0);
                var end = $("#slider-range").slider("values", 1);

                videoData[clipPlaying]["videoStart"] = start;
                videoData[clipPlaying]["videoEnd"] = end;
                ytplayer2.seekTo(start, 1);
                /*
                ytplayer2.loadVideoById({
                    'videoId': videoId,
                    'startSeconds': start,
                    'endSeconds': end
                });
                */
            }
        }


        /*
        * Chromeless player has no controls.
        */

        // Update a particular HTML element with a new value
        function updateHTML(elmId, value) {
            var elem = document.getElementById(elmId);

            if(typeof elem !== 'undefined' && elem !== null) {
                document.getElementById(elmId).innerHTML = value;
            }
        }
              
        // This function is called when an error is thrown by the player
        function onPlayerError(errorCode) {
            alert("An error occured of type:" + errorCode);
        }
              
        // This function is called when the player changes state
        function onPlayerStateChange(newState) {
            updateHTML("playerState", newState);
        }
              
        function onPlayerError2(errorCode2) {
            alert("An error occured of type:" + errorCode2);
        }
              

        // Display information about the current state of the player
        function updatePlayerInfo() {
            // Also check that at least one function exists since when IE unloads the
            // page, it will destroy the SWF before clearing the interval.
            if(typeof ytplayer.getDuration !== 'undefined')
            {
                if(ytplayer && ytplayer.getDuration()){
                    updateHTML("selectedId", id);
                    updateHTML("videoDuration", ytplayer.getDuration());
                    updateHTML("videoCurrentTime", ytplayer.getCurrentTime());
                    updateHTML("volume", ytplayer.getVolume());
                }
            }
        }

        function updatePlayerInfo2() {
            if(typeof ytplayer2.getDuration !== 'undefined') {
                if (typeof videoData[clipPlaying] !== 'undefined' && videoData[clipPlaying] !== null){
                    if (videoData[clipPlaying]["videoEnd"] < ytplayer2.getCurrentTime()) {
                        stopVideo2();
                    }
                    updateHTML("videoDuration2", ytplayer2.getDuration());
                    updateHTML("clipDuration", videoData[clipPlaying]["videoEnd"]);
                    updateHTML("videoCurrentTime2", ytplayer2.getCurrentTime());
                    updateHTML("videoCurrentTime3", ytplayer2.getCurrentTime());
                }
            }
        }
              
              
        function playVideo() {
            if (ytplayer && ytplayer.getPlayerState()!==-1) {
                ytplayer.playVideo();
            }
        }
              
        function pauseVideo() {
            if (ytplayer) {
                ytplayer.pauseVideo();
            }
        }
              
        function muteVideo() {
            if(ytplayer) {
                ytplayer.mute();
            }
        }
              
        function unMuteVideo() {
            if(ytplayer) {
                ytplayer.unMute();
            }
        }

        function stopVideo() {
            if(ytplayer) {
                ytplayer.stopVideo();
            }
        }

        function playFromStart2() {
            if (ytplayer2) {
                videoId = id;
                var url = "http://gdata.youtube.com/feeds/api/videos/" + videoId + "?v=2&alt=jsonc&prettyprint=true";
                $.get(url, function(data) { 
                    var duration = data["data"]["duration"];

                    $("#progress_bar_2").slider({
                        value: 0,
                        min: 0,
                        max: duration,
                        change: function(event, ui){
                            ytplayer2.seekTo(ui.value, 1);
                        }
                    }); 
                    ytplayer2.loadVideoById({
                        'videoId': videoId,
                        'startSeconds': 0 
                    });
                });
            }
        }

        function playVideo2() {
            if (ytplayer2 && ytplayer2.getPlayerState()!==-1) {
                ytplayer2.playVideo();
            }
        }
              
        function pauseVideo2() {
            if (ytplayer2) {
                ytplayer2.pauseVideo();
            }
        }
              
        function muteVideo2() {
            if(ytplayer2) {
                ytplayer2.mute();
            }
        }
              
        function unMuteVideo2() {
            if(ytplayer2) {
                ytplayer2.unMute();
            }
        }

        function stopVideo2() {
            if(ytplayer2) {
                ytplayer2.stopVideo();
            }
        }


        function chopCurrentTime() {
              if(ytplayer2 && id) {
                    var start;
                    var end;
                    if (ytplayer2.getCurrentTime() <= 5) {
                        start = 0;
                    }
                    else {
                        start = ytplayer2.getCurrentTime() - 5;
                    }

                    if (ytplayer2.getDuration() - ytplayer2.getCurrentTime() <= 5) {
                        end = ytplayer2.getDuration();
                    }
                    else {
                        end = ytplayer2.getCurrentTime() + 5;
                    }
                    

                    videoData[liNo] = {videoId: id, 
                                       videoStart: start, 
                                       videoEnd: end};

                    startTime = start;
                    endTime = end;

                    var l = '<li id=\"li' + liNo + '\"><div class=\"thumbnail\"><p><span id=\"a' + liNo + '\"><a onclick=\"loadVideo2(\'' + id + '\',' + start + ',' + end + ', ' + liNo + ')\" href=\"#\">' + start + '-' + end + '</a></span> | <a href=\"#\" onclick=\"deleteClip(' + liNo + ')\">delete</a></p><div class=\"input-group\"><span class=\"input-group-addon\">Question:</span><input class="form-control" id=\"question' + liNo + '\" type=\"text\" /></div><div class=\"input-group\"><span class=\"input-group-addon\">Answer:</span><input class=\"form-control\" id=\"answer' + liNo + '\" type=\"text\" /></div><div class=\"input-group\"><span class=\"input-group-addon\">Long Answer:</span><input class=\"form-control\" id=\"lanswer' + liNo + '\" type=\"text\" /></div></div></li>';
                    $("#chopedlist").append(l);

                    liNo++;
                    //isOriginal = 1;
              }
        }
        function deleteClip(liNo) {
            $("#li" + liNo).closest('li').remove();
            delete videoData[liNo];
        }


        function update() {
            for (var i in videoData) {
                videoData[i]["videoQuestion"] = document.getElementById("question" + i).value;
                videoData[i]["videoAnswer"] = document.getElementById("answer" + i).value;
                videoData[i]["videoLongAnswer"] = document.getElementById("lanswer" + i).value;
            }
            console.log(videoData);
            localStorage.clear();
            localStorage["data"] = JSON.stringify(videoData);
        }

    </script>
	<script src="https://apis.google.com/js/client.js?onload=onClientLoad" type="text/javascript"></script>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load("swfobject", "2.2");
    </script>    
    
    <script type="text/javascript">
        // This function is automatically called by the player once it loads
        function onYouTubePlayerReady(playerId) {
            
            if ((playerId == "player1") && $("#step1").is(":visible")) {
                ytplayer = document.getElementById("ytPlayer");
                $("#volumeSetting").slider({
                    value: 50,
                    min: 0,
                    max: 100,
                    change: function(event, ui){
                        ytplayer.setVolume(ui.value);
                    }
                }); 
                setInterval(updatePlayerInfo, 250);
                updatePlayerInfo();

                ytplayer.addEventListener("onStateChange", "onPlayerStateChange");
                ytplayer.addEventListener("onError", "onPlayerError");
            }

            if ((playerId == "player2")) {
                ytplayer2 = document.getElementById("ytPlayer2");
                setInterval(updatePlayerInfo2, 250);
                updatePlayerInfo2();
                ytplayer2.addEventListener("onStateChange", "onPlayerStateChange2");
                ytplayer2.addEventListener("onError", "onPlayerError2");
                ytplayer2.cueVideoById(id);
                playFromStart2();
            }
        }
              
        // The "main method" of this sample. Called when someone clicks "Run".
        function loadPlayer() {
            // Lets Flash from another domain call JavaScript
            var params = { allowScriptAccess: "always" };
            // The element id of the Flash embed
            var atts_1 = { id: "ytPlayer" };
            // All of the magic handled by SWFObject (http://code.google.com/p/swfobject/)
            swfobject.embedSWF("http://www.youtube.com/apiplayer?" + "version=3&enablejsapi=1&playerapiid=player1", "videoDiv", "480", "295", "9", null, null, params, atts_1);


            var atts_2 = { id: "ytPlayer2" };
            swfobject.embedSWF("http://www.youtube.com/apiplayer?" + "version=3&enablejsapi=1&playerapiid=player2", "videoDiv2", "480", "295", "9", null, null, params, atts_2);

        }

        function _run() {
            loadPlayer();
        }
        google.setOnLoadCallback(_run);
    </script>    
  </body>
</html>
